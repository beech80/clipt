import React, { useState, useEffect } from 'react';
import { useNavigate } from 'react-router-dom';
import { Users, Tv, ChevronLeft, Filter, Gamepad, Zap, Flame, Award, Music, Heart, Sword, Bomb, Cpu, TrendingUp, MessageSquare } from 'lucide-react';
import { toast } from 'sonner';
import { motion, AnimatePresence } from 'framer-motion';
import { createGlobalStyle, keyframes, css } from 'styled-components';

// Animation keyframes
const glowPulse = keyframes`
  0% { opacity: 0.6; filter: blur(10px); }
  50% { opacity: 0.8; filter: blur(15px); }
  100% { opacity: 0.6; filter: blur(10px); }
`;

const gradientShift = keyframes`
  0% { background-position: 0% 50%; }
  50% { background-position: 100% 50%; }
  100% { background-position: 0% 50%; }
`;

const pulse = keyframes`
  0% { transform: scale(1); opacity: 0.8; }
  50% { transform: scale(1.05); opacity: 1; }
  100% { transform: scale(1); opacity: 0.8; }
`;

const floatAnimation = keyframes`
  0% { transform: translateY(0px); }
  50% { transform: translateY(-10px); }
  100% { transform: translateY(0px); }
`;

const GlobalStyle = createGlobalStyle`
  * {
    box-sizing: border-box;
  }
  
  html {
    height: 100%;
    margin: 0;
    padding: 0;
    overflow: hidden;
  }
  
  body {
    height: 100%;
    margin: 0;
    padding: 0;
    overflow: auto;
    background-color: #0C0C0C !important;
    background-image: 
      radial-gradient(circle at 10% 10%, rgba(255, 85, 0, 0.1) 0%, transparent 30%),
      radial-gradient(circle at 90% 90%, rgba(255, 85, 0, 0.08) 0%, transparent 40%),
      linear-gradient(135deg, rgba(40, 20, 10, 0.9) 0%, rgba(25, 15, 10, 0.95) 100%) !important;
    background-attachment: fixed !important;
    color: white;
    font-family: 'Inter', sans-serif;
  }
  
  #root {
    min-height: 100vh;
    height: 100%;
    max-height: 100vh;
    background-color: #0C0C0C;
    overflow: hidden;
    position: relative;
  }

  .console-header {
    border-bottom: 2px solid rgba(255, 85, 0, 0.3);
    box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
    background: linear-gradient(to bottom, rgba(40, 25, 15, 0.9), rgba(30, 20, 15, 0.8));
    backdrop-filter: blur(10px);
  }

  .console-tab {
    border-radius: 12px 12px 0 0;
    border: 1px solid rgba(255, 85, 0, 0.2);
    border-bottom: none;
    transition: all 0.3s ease;
    background: linear-gradient(to bottom, rgba(50, 30, 20, 0.8), rgba(40, 25, 15, 0.6));
  }

  .console-tab.active {
    background: linear-gradient(to bottom, rgba(255, 85, 0, 0.2), rgba(255, 120, 20, 0.1));
    box-shadow: 0 -5px 15px rgba(255, 85, 0, 0.1);
  }

  .console-card {
    background: rgba(30, 20, 15, 0.7);
    border: 1px solid rgba(255, 85, 0, 0.15);
    border-radius: 16px;
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
    overflow: hidden;
    transition: all 0.3s ease;
  }

  .console-card:hover {
    transform: translateY(-8px) scale(1.02);
    box-shadow: 0 15px 30px rgba(255, 85, 0, 0.3);
    border: 1px solid rgba(255, 85, 0, 0.3);
  }

  .stream-card:hover .stream-glow {
    opacity: 0.8;
  }
  
  .stream-card {
    transition: all 0.3s ease;
    border-radius: 16px;
    overflow: hidden;
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.25);
  }
  
  .stream-card:hover {
    transform: translateY(-8px);
    box-shadow: 0 15px 30px rgba(255, 85, 0, 0.3);
  }
  
  .live-dot {
    animation: livePulse 1.5s infinite;
  }
  
  .gradient-text {
    background-size: 200% auto;
    background-image: linear-gradient(90deg, #FF5500, #FF7700, #FF5500);
    animation: ${props => css`${gradientShift} 3s infinite linear`};
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    text-fill-color: transparent;
  }
  
  .console-button {
    background: linear-gradient(to bottom, rgba(255, 85, 0, 0.4), rgba(255, 120, 20, 0.2));
    border: 1px solid rgba(255, 120, 20, 0.3);
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
    border-radius: 10px;
    transition: all 0.2s ease;
  }

  .console-button:hover {
    background: linear-gradient(to bottom, rgba(255, 85, 0, 0.5), rgba(255, 120, 20, 0.3));
    box-shadow: 0 4px 15px rgba(255, 85, 0, 0.3);
    transform: translateY(-2px);
  }

  .console-button:active {
    transform: translateY(1px);
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
  }
  
  @keyframes livePulse {
    0% { opacity: 0.6; transform: scale(0.8); }
    50% { opacity: 1; transform: scale(1.2); }
    100% { opacity: 0.6; transform: scale(0.8); }
  }
`;

const StreamingPageModern: React.FC = () => {
  const navigate = useNavigate();
  
  // Set body background to ensure dark theme throughout
  useEffect(() => {
    // Prevent scrolling past content
    document.body.style.backgroundColor = '#0C0C0C';
    document.body.style.overflow = 'hidden';
    document.documentElement.style.overflow = 'hidden';
    document.documentElement.style.height = '100%';
    
    // Use a more forceful approach to set background
    const style = document.createElement('style');
    style.innerHTML = `
      body, html, #root {
        background-color: #0C0C0C !important;
        min-height: 100vh !important;
        height: 100% !important;
        overflow: hidden !important;
      }
    `;
    document.head.appendChild(style);
    
    // Reset when component unmounts
    return () => {
      document.body.style.backgroundColor = '';
      document.body.style.overflow = '';
      document.documentElement.style.overflow = '';
      document.documentElement.style.height = '';
      document.head.removeChild(style);
    };
  }, []);
  // No longer using tabs - only showing streamers
  const [selectedGenre, setSelectedGenre] = useState<string>('all');
  const [showFilters, setShowFilters] = useState(false);
  const [isLoading, setIsLoading] = useState(true);
  
  // Simulate loading state
  useEffect(() => {
    setTimeout(() => {
      setIsLoading(false);
    }, 800);
  }, []);

  // Simple string array for genre IDs
  const genreIds = ['all', 'vibing', 'action', 'fps', 'strategy', 'rpg', 'sports', 'music', 'indie', 'trending', 'scifi'];

  // Icon mapping for genres
  const genreIcons: Record<string, React.ReactNode> = {
    all: <Tv size={14} />,
    vibing: <MessageSquare size={14} />,
    action: <Sword size={14} />,
    fps: <Bomb size={14} />,
    strategy: <Zap size={14} />,
    rpg: <Award size={14} />,
    sports: <TrendingUp size={14} />,
    music: <Music size={14} />,
    indie: <Heart size={14} />,
    trending: <Flame size={14} />,
    scifi: <Cpu size={14} />
  };
  
  // Genre name mapping
  const genreNames: Record<string, string> = {
    all: 'All Streams',
    vibing: 'Vibing',
    action: 'Action',
    fps: 'FPS',
    strategy: 'Strategy',
    rpg: 'RPG',
    sports: 'Sports',
    music: 'Music',
    indie: 'Indie',
    trending: 'Trending',
    scifi: 'Sci-Fi'
  };
  
  // Dummy data for streamers with genre tags
  const streamers = [
    { id: '1', name: 'Pro Gamer', game: 'Fortnite', viewers: 12453, genres: ['action', 'fps', 'trending'], avatar: 'https://randomuser.me/api/portraits/men/32.jpg' },
    { id: '2', name: 'Gaming Pro', game: 'Minecraft', viewers: 8721, genres: ['indie', 'strategy'], avatar: 'https://randomuser.me/api/portraits/women/44.jpg' },
    { id: '3', name: 'Game Master', game: 'League of Legends', viewers: 15210, genres: ['strategy', 'trending'], avatar: 'https://randomuser.me/api/portraits/men/22.jpg' },
    { id: '4', name: 'Awesome Player', game: 'Call of Duty', viewers: 7182, genres: ['fps', 'action'], avatar: 'https://randomuser.me/api/portraits/women/28.jpg' },
    { id: '5', name: 'Epic Gamer', game: 'Apex Legends', viewers: 9345, genres: ['fps', 'trending'], avatar: 'https://randomuser.me/api/portraits/men/42.jpg' },
    { id: '6', name: 'RPG Lover', game: 'Elden Ring', viewers: 6230, genres: ['rpg', 'action'], avatar: 'https://randomuser.me/api/portraits/women/24.jpg' },
    { id: '7', name: 'Chill Talker', game: 'Just Chatting', viewers: 5430, genres: ['vibing'], avatar: 'https://randomuser.me/api/portraits/women/68.jpg' },
    { id: '8', name: 'Late Night Vibes', game: 'IRL', viewers: 8910, genres: ['vibing', 'trending'], avatar: 'https://randomuser.me/api/portraits/men/75.jpg' },
    { id: '9', name: 'Sports Fan', game: 'NBA 2K23', viewers: 4290, genres: ['sports', 'trending'], avatar: 'https://randomuser.me/api/portraits/men/81.jpg' },
    { id: '10', name: 'Music Producer', game: 'Beat Making', viewers: 3850, genres: ['music', 'vibing'], avatar: 'https://randomuser.me/api/portraits/women/54.jpg' }
  ];

  // Dummy data for categories with genre tags
  const categories = [
    { id: 'vibing101', name: 'Just Chatting', viewers: 325700, genres: ['vibing', 'trending'], image: 'https://images.unsplash.com/photo-1529156069898-49953e39b3ac?q=80&w=300&h=200' },
    { id: 'fort123', name: 'Fortnite', viewers: 245300, genres: ['action', 'fps', 'trending'], image: 'https://images.unsplash.com/photo-1626628571517-1d1d17a7e312?q=80&w=300&h=200' },
    { id: 'mc456', name: 'Minecraft', viewers: 183450, genres: ['indie', 'strategy'], image: 'https://images.unsplash.com/photo-1592155931584-901ac15763e3?q=80&w=300&h=200' },
    { id: 'lol789', name: 'League of Legends', viewers: 321000, genres: ['strategy', 'trending'] },
    { id: 'cod321', name: 'Call of Duty', viewers: 178500, genres: ['fps', 'action'] },
    { id: 'apex456', name: 'Apex Legends', viewers: 198700, genres: ['fps', 'trending'] },
    { id: 'elden789', name: 'Elden Ring', viewers: 142600, genres: ['rpg', 'action'] }
  ];

  // Filter streamers and categories based on selected genre
  const filteredStreamers = selectedGenre === 'all' 
    ? streamers 
    : streamers.filter(streamer => streamer.genres.includes(selectedGenre.toLowerCase()));
    
  // Make sure we're using string values for display
  const displayGenreName = selectedGenre === 'all' ? 'All Content' : genreNames[selectedGenre] || selectedGenre;
  
  const filteredCategories = selectedGenre === 'all' 
    ? categories 
    : categories.filter(category => category.genres.includes(selectedGenre.toLowerCase()));
  const streamers = [
    { id: '1', name: 'Pro Gamer', game: 'Fortnite', viewers: 12453, genres: ['action', 'fps', 'trending'], avatar: 'https://randomuser.me/api/portraits/men/32.jpg' },
    { id: '2', name: 'Gaming Pro', game: 'Minecraft', viewers: 8721, genres: ['indie', 'strategy'], avatar: 'https://randomuser.me/api/portraits/women/44.jpg' },
    { id: '3', name: 'Game Master', game: 'League of Legends', viewers: 15210, genres: ['strategy', 'trending'], avatar: 'https://randomuser.me/api/portraits/men/22.jpg' },
    { id: '4', name: 'Awesome Player', game: 'Call of Duty', viewers: 7182, genres: ['fps', 'action'], avatar: 'https://randomuser.me/api/portraits/women/28.jpg' },
    { id: '5', name: 'Epic Gamer', game: 'Apex Legends', viewers: 9345, genres: ['fps', 'trending'], avatar: 'https://randomuser.me/api/portraits/men/42.jpg' },
    { id: '6', name: 'RPG Lover', game: 'Elden Ring', viewers: 6230, genres: ['rpg', 'action'], avatar: 'https://randomuser.me/api/portraits/women/24.jpg' },
    { id: '7', name: 'Chill Talker', game: 'Just Chatting', viewers: 5430, genres: ['vibing'], avatar: 'https://randomuser.me/api/portraits/women/68.jpg' },
    { id: '8', name: 'Late Night Vibes', game: 'IRL', viewers: 8910, genres: ['vibing', 'trending'], avatar: 'https://randomuser.me/api/portraits/men/75.jpg' },
    { id: '9', name: 'Sports Fan', game: 'NBA 2K23', viewers: 4290, genres: ['sports', 'trending'], avatar: 'https://randomuser.me/api/portraits/men/81.jpg' },
    { id: '10', name: 'Music Producer', game: 'Beat Making', viewers: 3850, genres: ['music', 'vibing'], avatar: 'https://randomuser.me/api/portraits/women/54.jpg' }
  ];

  // Dummy data for categories with genre tags
  const categories = [
    { id: 'vibing101', name: 'Just Chatting', viewers: 325700, genres: ['vibing', 'trending'], image: 'https://images.unsplash.com/photo-1529156069898-49953e39b3ac?q=80&w=300&h=200' },
    { id: 'fort123', name: 'Fortnite', viewers: 245300, genres: ['action', 'fps', 'trending'], image: 'https://images.unsplash.com/photo-1626628571517-1d1d17a7e312?q=80&w=300&h=200' },
    { id: 'mc456', name: 'Minecraft', viewers: 183450, genres: ['indie', 'strategy'], image: 'https://images.unsplash.com/photo-1592155931584-901ac15763e3?q=80&w=300&h=200' },
    { id: 'lol789', name: 'League of Legends', viewers: 321000, genres: ['strategy', 'trending'] },
    { id: 'cod321', name: 'Call of Duty', viewers: 178500, genres: ['fps', 'action'] },
    { id: 'apex456', name: 'Apex Legends', viewers: 198700, genres: ['fps', 'trending'] },
    { id: 'elden789', name: 'Elden Ring', viewers: 142600, genres: ['rpg', 'action'] }
  ];

  // Go back to previous page
  const goBack = () => {
    navigate(-1);
  };

  return (
    // ... (rest of the code remains the same)
                        display: 'flex',
                        flexDirection: 'column',
                        justifyContent: 'flex-end',
                        padding: '15px',
                        position: 'relative',
                        transformStyle: 'preserve-3d',
                        transform: 'translateZ(10px)'
                      }}>

                        {/* Circular avatar */}
                        <motion.div
                          initial={{ scale: 0.8, opacity: 0 }}
                          animate={{ scale: 1, opacity: 1 }}
                          transition={{ delay: index * 0.1 + 0.2 }}
                          style={{
                            position: 'absolute',
                            top: '15px',
                            left: '15px',
                            width: '50px',
                            height: '50px',
                            borderRadius: '50%',
                            overflow: 'hidden',
                            border: '2px solid rgba(255, 85, 0, 0.6)',
                            boxShadow: '0 4px 10px rgba(0, 0, 0, 0.3)',
                            zIndex: 2,
                            transform: 'translateZ(20px)'
                          }}
                        >
                          <img 
                            src={streamer.avatar} 
                            alt={streamer.name} 
                            style={{ width: '100%', height: '100%', objectFit: 'cover' }} 
                          />
                        </motion.div>
                        <motion.div 
                          animate={{ 
                            y: [0, -2, 0],
                            scale: [1, 1.02, 1] 
                          }}
                          transition={{ 
                            duration: 2, 
                            repeat: Infinity,
                            repeatType: 'reverse' 
                          }}
                          style={{
                            position: 'absolute',
                            top: '10px',
                            right: '10px',
                            backgroundColor: 'rgba(42, 26, 18, 0.9)',
                            borderRadius: '10px',
                            padding: '5px 12px',
                            fontSize: '12px',
                            fontWeight: 'bold',
                            color: '#FF5500',
                            border: '1px solid rgba(255, 85, 0, 0.3)',
                            display: 'flex',
                            alignItems: 'center',
                            gap: '5px',
                            boxShadow: '0 2px 10px rgba(0, 0, 0, 0.3)'
                          }}>
                          <span className="live-dot" style={{ 
                            width: '8px', 
                            height: '8px', 
                            borderRadius: '50%', 
                            backgroundColor: '#FF5500', 
                            display: 'inline-block' 
                          }}></span>
                          LIVE
                        </motion.div>
                        <h3 style={{ 
                          fontSize: '18px', 
                          margin: '0',
                          color: 'white',
                          fontWeight: 'bold'
                        }}>
                          {streamer.name}
                        </h3>
                        <p style={{
                          fontSize: '14px', 
                          color: '#FF5500',
                          margin: '5px 0 0',
                          fontWeight: 'bold'
                        }}>
                          {streamer.game} • {streamer.viewers.toLocaleString()} viewers
                        </p>
                      </motion.div>
                      <motion.div style={{
                        padding: '15px',
                        display: 'flex',
                        flexWrap: 'wrap',
                        gap: '6px'
                      }}>
                        {streamer.genres.map(genre => {
                          // Make sure we're using a string value, not an object
                          const genreText = typeof genre === 'object' && genre !== null ? 
                            (genre.name || genre.id || JSON.stringify(genre)) : 
                            String(genre);
                            
                          return (
                            <motion.span 
                              key={genreText} 
                              whileHover={{ scale: 1.1 }}
                              style={{
                                backgroundColor: 'rgba(42, 26, 18, 0.7)',
                                color: '#FF7700',
                                borderRadius: '12px',
                                padding: '3px 10px',
                                fontSize: '11px',
                                fontWeight: 'bold',
                                border: '1px solid rgba(255, 85, 0, 0.3)',
                                cursor: 'pointer',
                                boxShadow: '0 2px 5px rgba(0,0,0,0.2)'
                              }}
                            >{genreText}</motion.span>
                          );
                        })}
                      </motion.div>
                      {/* Animated glow effect */}
                      <motion.div 
                        className="stream-glow"
                        style={{
                          position: 'absolute',
                          bottom: '-20px',
                          right: '-20px',
                          width: '150px',
                          height: '150px',
                          borderRadius: '50%',
                          background: 'radial-gradient(circle, rgba(255, 85, 0, 0.15) 0%, rgba(255, 85, 0, 0) 70%)',
                          opacity: 0.3,
                          transition: 'opacity 0.3s ease',
                          animationName: `${glowPulse.getName()}`,
                          animationDuration: '3s',
                          animationIterationCount: 'infinite',
                          animationTimingFunction: 'ease-in-out',
                          zIndex: 1
                        }}
                      />
                    </motion.div>
                ))}
              </motion.div>
            </motion.div>
          )}
        </AnimatePresence>
        
        {/* Extra space to ensure background extends to bottom */}
        <motion.div style={{ 
          height: '200px', 
          width: '100%',
          backgroundColor: '#0C0C0C',
          position: 'relative',
          flexShrink: 0
        }} />
      </motion.div>
    </>
  );
};

export default StreamingPageModern;
