/* Enhanced Animations for the Xbox-style joystick */
@keyframes pulse-arrow {
  0% { opacity: 0.3; transform: scaleY(1); filter: brightness(100%); }
  50% { opacity: 0.9; transform: scaleY(1.3); filter: brightness(130%); }
  100% { opacity: 0.3; transform: scaleY(1); filter: brightness(100%); }
}

@keyframes glow-up {
  0% { box-shadow: 0 -4px 10px rgba(135, 106, 245, 0.5), inset 0 -1px 2px rgba(255, 255, 255, 0.2); }
  50% { box-shadow: 0 -10px 22px rgba(135, 106, 245, 0.9), inset 0 -2px 4px rgba(255, 255, 255, 0.4); }
  100% { box-shadow: 0 -3px 8px rgba(135, 106, 245, 0.4); }
}

@keyframes glow-down {
  0% { box-shadow: 0 4px 10px rgba(135, 106, 245, 0.5), inset 0 1px 2px rgba(255, 255, 255, 0.2); }
  50% { box-shadow: 0 10px 22px rgba(135, 106, 245, 0.9), inset 0 2px 4px rgba(255, 255, 255, 0.4); }
  100% { box-shadow: 0 3px 8px rgba(135, 106, 245, 0.4); }
}

/* Improved spring animation with more natural bounce and physics */
@keyframes xbox-spring-return {
  0% { transform: translate(var(--last-x, 0), var(--last-y, 0)); box-shadow: 0 0 20px rgba(135, 106, 245, 0.6); }
  15% { transform: translate(calc(var(--last-x, 0) * 0.6), calc(var(--last-y, 0) * 0.6)); box-shadow: 0 0 18px rgba(135, 106, 245, 0.55); }
  30% { transform: translate(calc(var(--last-x, 0) * 0.25), calc(var(--last-y, 0) * 0.25)); box-shadow: 0 0 16px rgba(135, 106, 245, 0.5); }
  45% { transform: translate(calc(var(--last-x, 0) * 0.05), calc(var(--last-y, 0) * 0.05)); box-shadow: 0 0 14px rgba(135, 106, 245, 0.45); }
  60% { transform: translate(calc(var(--last-x, 0) * -0.03), calc(var(--last-y, 0) * -0.03)); box-shadow: 0 0 12px rgba(135, 106, 245, 0.4); }
  75% { transform: translate(calc(var(--last-x, 0) * -0.01), calc(var(--last-y, 0) * -0.01)); box-shadow: 0 0 10px rgba(135, 106, 245, 0.35); }
  85% { transform: translate(calc(var(--last-x, 0) * 0.005), calc(var(--last-y, 0) * 0.005)); box-shadow: 0 0 8px rgba(135, 106, 245, 0.3); }
  100% { transform: translate(0, 0); box-shadow: 0 0 5px rgba(135, 106, 245, 0.1); }
}

/* Enhanced joystick movement with improved smoothness */
.joystick-handle {
  /* Use hardware acceleration for smoother movement */
  transform: translate3d(0, 0, 0);
  backface-visibility: hidden;
  perspective: 1000px;
  
  /* Smooth out transition */
  transition: transform 0.008s cubic-bezier(0.17, 0.84, 0.44, 1), 
              box-shadow 0.06s ease, 
              filter 0.06s ease;
  
  /* Improve performance with will-change */
  will-change: transform, box-shadow, filter;
  
  /* Improved 3D feel with subtle shadow during movement */
  filter: drop-shadow(0 3px 12px rgba(0, 0, 0, 0.7));
  
  /* Add a subtle glow effect when moving */
  box-shadow: 0 0 12px rgba(135, 106, 245, 0.5), inset 0 0 4px rgba(255, 255, 255, 0.3);
  backdrop-filter: blur(2px);
}

/* Enhance touch visibility - scale up slightly when active */
.joystick-handle:active {
  transform: scale3d(1.18, 1.18, 1); /* Using scale3d for hardware acceleration */
  box-shadow: 0 0 25px rgba(135, 106, 245, 0.95), inset 0 0 8px rgba(255, 255, 255, 0.4);
  filter: brightness(1.4) contrast(1.1);
  transition: transform 0.04s ease-out, box-shadow 0.04s ease-out, filter 0.04s ease-out;
}

.joystick-spring-return {
  animation: xbox-spring-return 0.5s cubic-bezier(0.25, 1.2, 0.5, 1) forwards;
  /* Disable transition during spring animation */
  transition: none !important;
}

/* Active indicator styles with variable intensity */
.joystick-up-indicator.active {
  background: rgba(135, 106, 245, calc(0.5 + var(--intensity, 50) / 200)) !important;
  height: calc(8px + (var(--intensity, 50) / 10)) !important;
  animation: pulse-arrow 1.2s infinite ease-in-out !important;
  filter: brightness(calc(100% + var(--intensity, 0) / 2)) !important;
  transition: all 0.05s ease-out !important;
  box-shadow: 0 -2px 8px rgba(135, 106, 245, 0.7) !important;
}

.joystick-down-indicator.active {
  background: rgba(135, 106, 245, calc(0.5 + var(--intensity, 50) / 200)) !important;
  transition: all 0.05s ease-out !important;
  height: calc(8px + (var(--intensity, 50) / 10)) !important;
  animation: pulse-arrow 1.2s infinite ease-in-out !important;
  filter: brightness(calc(100% + var(--intensity, 0) / 2)) !important;
  box-shadow: 0 2px 8px rgba(135, 106, 245, 0.7) !important;
}

.joystick-handle-up {
  animation: glow-up 0.8s infinite ease-in-out !important;
  border-bottom: 3px solid rgba(135, 106, 245, calc(0.6 + var(--move-intensity, 50) / 200)) !important;
  box-shadow: 0 -4px calc(6px + var(--move-intensity, 0) / 8 * 1px) rgba(135, 106, 245, calc(0.5 + var(--move-intensity, 0) / 200)), 
              inset 0 -2px 4px rgba(255, 255, 255, 0.3) !important;
  filter: drop-shadow(0 -4px 8px rgba(135, 106, 245, 0.6)) !important;
}

.joystick-handle-down {
  animation: glow-down 0.8s infinite ease-in-out !important;
  border-top: 3px solid rgba(135, 106, 245, calc(0.6 + var(--move-intensity, 50) / 200)) !important;
  box-shadow: 0 4px calc(6px + var(--move-intensity, 0) / 8 * 1px) rgba(135, 106, 245, calc(0.5 + var(--move-intensity, 0) / 200)),
              inset 0 2px 4px rgba(255, 255, 255, 0.3) !important;
  filter: drop-shadow(0 4px 8px rgba(135, 106, 245, 0.6)) !important;
}

/* Intensity classes for better visual feedback */
.low-intensity {
  filter: brightness(110%) !important;
  transition: filter 0.15s ease !important;
}

.medium-intensity {
  filter: brightness(125%) !important;
  transition: filter 0.12s ease !important;
}

.high-intensity {
  filter: brightness(140%) !important;
  text-shadow: 0 0 5px rgba(255, 255, 255, 0.5) !important;
  transition: filter 0.08s ease, text-shadow 0.08s ease !important;
}
